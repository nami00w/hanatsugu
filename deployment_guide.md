# Hanatsugu 実際のサービス運用ガイド

## 🚀 実際のデプロイメント手順

### 1. データベース設定（管理者のみ）

#### Supabaseでの作業：
1. **Supabase Dashboard** にログイン
2. **SQL Editor** で `supabase_setup.sql` を実行（テーブル構造のみ）
3. **Storage** でバケット作成：
   - `dress-images` (public)
   - `profile-images` (public)

#### 環境変数設定：
```bash
# .env.local
NEXT_PUBLIC_SUPABASE_URL=your_actual_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_actual_anon_key
```

### 2. ユーザーによるデータ作成の流れ

#### ユーザーがサービスを利用する実際の流れ：

```
1. ユーザー登録 → Supabase Auth
2. プロフィール設定 → 設定ページのUI
3. ドレス出品 → 出品ページのUI
4. お気に入り追加 → ハートボタン
5. 売上管理 → マイページのUI
```

### 3. 実際のデータ投入方法

#### サンプルドレスの作成（テスト用）：
1. テストユーザーでログイン
2. `/sell` ページから実際に出品
3. 以下のようなドレス情報で出品：

```
タイトル: エレガントレースウェディングドレス
ブランド: VERA WANG
価格: 280,000円
サイズ: 9号
状態: 美品
...
```

#### 管理者用の一括データ投入（必要な場合）：
```sql
-- 管理者のみ実行
-- 実際のuser_idを取得してから実行
SELECT id, email FROM auth.users;

-- そのIDを使ってサンプルデータ投入
INSERT INTO listings (...) VALUES (...);
```

### 4. 本番環境での推奨運用

#### 4.1 初期セットアップ
- [ ] Supabaseプロジェクト作成
- [ ] テーブル構造のみ作成（SQLファイル実行）
- [ ] ストレージバケット作成
- [ ] 環境変数設定
- [ ] Vercelデプロイ

#### 4.2 コンテンツ管理
- [ ] 管理者がカテゴリマスター作成
- [ ] サンプルドレス数点を管理者が出品
- [ ] ユーザーは通常の出品フローを使用

#### 4.3 データ管理
- [ ] ユーザーデータはアプリUI経由のみ
- [ ] 管理者は必要に応じてSQL実行
- [ ] バックアップ・復旧手順整備

### 5. セキュリティ考慮事項

#### 5.1 Row Level Security (RLS)
```sql
-- 既に設定済み
-- ユーザーは自分のデータのみアクセス可能
-- 管理者のみ全データアクセス可能
```

#### 5.2 API制限
- SupabaseのAPI制限設定
- レート制限の設定
- 不正アクセス監視

### 6. 監視・メンテナンス

#### 6.1 ログ監視
- Supabase Dashboard でのアクセスログ確認
- エラーログの定期確認
- パフォーマンス監視

#### 6.2 定期メンテナンス
- 画像ストレージの容量確認
- 不要データの削除
- セキュリティアップデート

## 🎯 推奨する初回セットアップ

### Step 1: テーブル作成のみ
```sql
-- supabase_setup.sql の一部のみ実行
-- テーブル構造 + RLS + インデックス
-- サンプルデータは除外
```

### Step 2: テストユーザー作成
1. 実際にサインアップ
2. プロフィール設定
3. 数点のドレス出品

### Step 3: 動作確認
- 出品・編集・削除
- お気に入り機能
- 売上管理機能
- 設定変更

### Step 4: 本番運用開始
- ユーザーは通常フローでサービス利用
- 管理者は必要に応じてデータ確認

## 💡 重要なポイント

1. **ユーザーはSQLを実行しない**
2. **すべてアプリのUIを通じて操作**
3. **管理者のみデータベース直接アクセス**
4. **セキュリティ設定は最重要**
5. **定期的な監視とメンテナンス**

これにより、実際のサービスとして安全かつ効率的に運用できます。